# 一款简单的工作流框架

## 准备阶段
1、建表
请将 resources/sql 文件夹下的建表sql 执行。

## 简单解释：如何使用七张表实现简单的审批流

**work_flow**：此表存储了审批流的信息，如：请假申请、降额申请 等等。只记录名称即可

**work_flow_node**： 此表存储了审批流的节点信息，如请假申请的申请节点，审批节点等等。

**work_flow_node_link**： 此表存储了审批流的节点的前后关系，简单审批流都是串行的链表设计，所以这里要维护节点之前的顺序，如 请假申请：请假申请-> HRBP审批 -> leader 审批 -> 结束节点。

**work_flow_node_approver**：当节点有审批人时，审批人信息存储于此表，如  请假申请的 HRBP 审批 会维护 此节点的审批人信息。（当然动态的审批人，并不适合直接设置审批人，可能是自定义，或者根据角色来设定审批人，具体的申请的审批人会在 **Apply_node_approver** 中）




**Apply**: 真正的申请信息，**work_flow** 维护了 所有的申请信息，而 **Apply** 则维护了 申请的详细信息。

**Apply_node**：针对**Apply**的节点信息，当审批通过时，才会创建新的节点信息。

**Apply_node_approver**：则对应了Apply_node的审批人信息。

### 完整的流程如下

用户填写 请假申请，
- 后台创建请假申请Apply（根据workflow），
- 创建申请节点信息 apply_node（根据workflow的first_node_id）, 
- 然后创建下一节点 apply_node (根据 workflow_node_link)，有审批人，则根据workflow_node_approver 在 Apply_node_approver 中创建信息。

## 原理介绍

## 创建普通审批流
1. 在 ```workflow``` 表中创建审批流名称，以及首节点 
2. 在 ```workflow_node``` 表中创建 此审批流中的节点。 
3. 在 ```workflow_node_link``` 创建节点之间的关系.(成功、失败、自定义)。

## 创建特殊审批流(自定义节点执行逻辑)
以 请假为例
1. 在 ```workflow``` 表中创建 请假 审批流名称，以及首节点
2. 在 ```workflow_node``` 表中创建 此审批流中的节点。 申请人提交申请-> HRBP审批 -> Leader审批(通知) -> 大于15天 Leader+1 审批(通知) -> 结束. (任意节点拒绝则整个审批结束)
   1. Leader审批 会有通知。 因此 上一节点需要自定义处理器（因为节点处理器 控制下一节点的创建逻辑 和 创建后操作）
   2. Leader+1 审批 有先提条件 和通知。因此 上一节点需要自定义处理器
3. 在 ```workflow_node_link``` 创建节点之间的关系.(成功、失败、自定义)。
